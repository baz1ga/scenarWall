<!DOCTYPE html>
<html lang="fr" class="min-h-screen">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>.ScenarWall.</title>
  <link rel="preload" href="/assets/css/tailwind.css" as="style">
  <link rel="preload" href="/assets/fontawesome/css/all.min.css" as="style">
  <link rel="preload" href="/assets/js/alpinejs.min.js" as="script">
  <style>
    /* Couleur de fond minimale pour √©viter le flash blanc avant chargement CSS */
    body { background: #f8fafc; color: #0f172a; }
    .dark body { background: #0f172a; color: #e2e8f0; }
  </style>
  <script>
    // Appliquer le th√®me dark le plus t√¥t possible pour √©viter le flash clair
    (function() {
      try {
        const theme = localStorage.getItem('sw_theme');
        if (theme === 'dark') document.documentElement.classList.add('dark');
      } catch (e) {}
    })();
  </script>
  <link rel="icon" href="/assets/favicons/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="stylesheet" href="/assets/css/tailwind.css">
  <link rel="stylesheet" href="/assets/fontawesome/css/all.min.css">
  <script src="/js/common/config.js"></script>
  <script src="/js/common/auth.js"></script>
  <script type="module" src="/admin/js/dashboard.js"></script>
  <script defer src="/assets/js/alpinejs.min.js"></script>
  <style>
    @font-face {
      font-family: 'Pangolin';
      src: url('/assets/font/Pangolin-Regular.ttf') format('truetype');
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }
    .font-pangolin { font-family: 'Pangolin', 'Comic Sans MS', cursive; }
    [x-cloak]{display:none!important}
  </style>
</head>
<body class="min-h-screen h-screen overflow-hidden flex bg-slate-50 text-slate-900 dark:bg-gray-800 dark:text-slate-100">
  <div class="flex h-full w-full bg-slate-50 dark:bg-gray-800">
    <!-- SIDEBAR -->
    <aside class="bg-white dark:bg-gray-950 border-r border-slate-200 dark:border-gray-800 flex flex-col sticky top-0 h-screen transition-all duration-200" 
      :class="sidebarCollapsed ? 'w-[54px]' : 'w-56'">
      <div class="px-3 py-5 flex items-center justify-center">
        <div class="text-3xl font-semibold text-emerald-500 font-pangolin text-center" x-show="!sidebarCollapsed">.ScenarWall.</div>
        <div class="text-xl font-semibold text-emerald-500 font-pangolin" x-show="sidebarCollapsed">.SW.</div>
      </div>
      <nav class="flex-1" :class="sidebarCollapsed ? 'px-1' : 'px-3'">
        <a href="/admin/scenarios/list.html" class="w-full flex items-center rounded-lg text-sm font-medium text-left transition"
          :class="[
            sidebarCollapsed ? 'justify-center gap-0 px-0 py-2' : 'justify-start gap-2 px-2 pl-3 py-1',
            section === 'scenarios' ? 'bg-slate-800 text-emerald-300' : 'text-slate-700 dark:text-slate-200 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 hover:text-emerald-700 dark:hover:text-emerald-200'
          ]">
          <i class="fa-solid fa-scroll text-base"></i>
          <span x-show="!sidebarCollapsed">Sc√©narios</span>
        </a>
        <!-- liste des scenar & sessions -->
        <div class="space-y-0 mt-0 ml-4" x-show="!sidebarCollapsed">
          <template x-for="sc in recentScenarios" :key="sc.id">
            <div class="block px-3 py-1 rounded-md text-xs font-medium text-left text-slate-700 dark:text-slate-200 mb-1">
              <div class="flex items-center gap-2 font-semibold">
                <i class="text-sm" :class="sc.icon || defaultScenarioIcon"></i>
                <span class="truncate" x-text="sc.title || sc.id"></span>
              </div>
              <template x-if="Array.isArray(sc.sessions) && sc.sessions.length">
                <div class="">
                  <template x-for="sessId in sc.sessions.slice(0,3)" :key="sessId">
                    <a :href="`/admin/sessions/edit-scenes.html?id=${encodeURIComponent(sessId)}`"
                       class="flex w-full items-center gap-2 text-[11px] text-slate-600 dark:text-slate-200 rounded-md pl-3 pr-2 py-1 transition hover:bg-emerald-50 dark:hover:bg-emerald-900/25 hover:text-emerald-600">
                      <i class="fa-regular fa-circle-dot text-xs"></i>
                      <span class="truncate" x-text="lookupSessionTitle(sessId)"></span>
                    </a>
                  </template>
                </div>
              </template>
            </div>
          </template>
        </div>
        
        <!-- liste des entr√©es -->
        <div class="mt-3">
          <div class="px-3 text-[11px] mb-1 uppercase tracking-[0.08em] text-slate-500 dark:text-slate-200" x-show="!sidebarCollapsed">Biblioth√®que</div>
          <div :class="[sidebarCollapsed ? '' : 'ml-4']">
            <a href="/admin/gallery/gallery.html" class="flex items-center rounded-lg text-xs font-medium text-left transition mb-1"
              :class="[
            sidebarCollapsed ? 'justify-center gap-0 px-0 py-2' : 'justify-start gap-2 px-3 py-1',
              section === 'galerie' ? 'bg-slate-800 text-yellow-300' : 'text-slate-700 dark:text-slate-200 hover:bg-yellow-50 dark:hover:bg-yellow-900/20 hover:text-yellow-700 dark:hover:text-yellow-200'
            ]">
              <i class="fa-regular fa-image text-base"></i>
              <span x-show="!sidebarCollapsed">Galerie</span>
            </a>
            <a href="/admin/audio/audio.html" class="flex items-center rounded-lg text-xs font-medium text-left transition mb-1"
              :class="[
            sidebarCollapsed ? 'justify-center gap-0 px-0 py-2' : 'justify-start gap-2 px-3 py-1',
              section === 'audio' ? 'bg-slate-800 text-lime-300' : 'text-slate-700 dark:text-slate-200 hover:bg-lime-50 dark:hover:bg-lime-900/20 hover:text-lime-700 dark:hover:text-lime-200'
            ]">
              <i class="fa-solid fa-music text-base"></i>
              <span x-show="!sidebarCollapsed">Audio</span>
            </a>
            <a href="/admin/notes/notes.html" class="flex items-center rounded-lg text-xs font-medium text-left transition mb-1"
              :class="[
            sidebarCollapsed ? 'justify-center gap-0 px-0 py-2' : 'justify-start gap-2 px-3 py-1',
              section === 'notes' ? 'bg-slate-800 text-sky-400' : 'text-slate-700 dark:text-slate-200 hover:bg-sky-50 dark:hover:bg-sky-900/20 hover:text-sky-700 dark:hover:text-sky-200'
            ]">
              <i class="fa-solid fa-note-sticky text-base"></i>
              <span x-show="!sidebarCollapsed">Notes</span>
            </a>
          </div>
        </div>
        <!-- liste des entr√©es admin -->
        <div class="mt-3" x-show="isSuperAdmin">
          <div class="px-3 text-[11px] mb-1 uppercase tracking-[0.08em] text-slate-500 dark:text-slate-200" x-show="!sidebarCollapsed">Administration</div>
          <div :class="[sidebarCollapsed ? '' : 'ml-4']">
            <a href="/admin/games/games.html" class="flex items-center rounded-lg text-xs font-medium text-left transition mb-1"
              :class="[
            sidebarCollapsed ? 'justify-center gap-0 px-0 py-2' : 'justify-start gap-2 px-3 py-1',
              section === 'games' ? 'bg-slate-800 text-amber-300' : 'text-slate-700 dark:text-amber-200 hover:bg-amber-50 dark:hover:bg-amber-900/20 hover:text-amber-700 dark:hover:text-amber-200'
            ]">
              <i class="fa-solid fa-dice text-base"></i>
              <span x-show="!sidebarCollapsed">Parties jou√©es</span>
            </a>
            <a href="/admin/users/users.html" class="flex items-center rounded-lg text-xs font-medium text-left transition mb-1"
              :class="[
            sidebarCollapsed ? 'justify-center gap-0 px-0 py-2' : 'justify-start gap-2 px-3 py-1',
              section === 'users' ? 'bg-slate-800 text-cyan-300' : 'text-slate-700 dark:text-slate-200 hover:bg-cyan-50 dark:hover:bg-cyan-900/20 hover:text-cyan-700 dark:hover:text-cyan-200'
            ]">
              <i class="fa-solid fa-user-gear text-base"></i>
              <span x-show="!sidebarCollapsed">Utilisateurs</span>
            </a>
          </div>
        </div>
      </nav>
      <!-- donaxation box -->
      <div class="px-3 pt-3 mb-4" x-show="!sidebarCollapsed">
        <div class="p-2 text-center shadow-sm text-sm">
          <p class="text-slate-700 dark:text-slate-300 mb-3">Un coup de pouce pour l'h√©bergement et la üç∫</p>
          <a class="inline-flex items-center justify-center gap-2 rounded-lg bg-emerald-500 text-slate-900 font-semibold px-3 py-2 text-sm hover:bg-emerald-400 transition" href="https://www.buymeacoffee.com/baz1ga" target="_blank" rel="noopener">
            <i class="fa-solid fa-heart"></i> Soutenez-nous
          </a>
        </div>
      </div>
      <!-- user feedback -->
      <div class="px-3 pb-2 mb-4" x-show="!sidebarCollapsed">
        <a class="inline-flex w-full items-center gap-2 rounded-lg text-center border border-slate-200 dark:border-gray-800 text-slate-700 dark:text-slate-200 font-semibold px-3 py-2 text-sm hover:bg-slate-50 dark:hover:bg-slate-800 transition"
           href="https://tally.so/r/NpqM6N" target="_blank" rel="noopener">
          üé≤ Envie d'am√©liorer .ScenarWall. ?
        </a>
      </div>

      <!-- avatar/menu et  collapse button-->
      <div class="flex items-center" :class="sidebarCollapsed ? 'px-1 pb-4 justify-end gap-0' : 'px-3 pb-4 justify-between gap-2'">
        <!-- avatar/menu et  collapse button-->
        <div class="relative" @click.outside="userMenu=false" x-show="!sidebarCollapsed">
          <!-- avatar -->
          <button class="h-10 w-10 rounded-full bg-emerald-500 text-slate-900 font-semibold flex items-center justify-center hover:bg-emerald-400 overflow-hidden border border-slate-300 dark:border-gray-700"
                  @click.stop="userMenu = !userMenu">
            <template x-if="avatarUrl">
              <img :src="avatarUrl" alt="Avatar" class="h-full w-full object-cover">
            </template>
            <template x-if="!avatarUrl">
              <span class="text-sm font-semibold" x-text="avatarInitial"></span>
            </template>
          </button>
          <!-- menu -->
          <div class="absolute left-[-5px] bottom-12 w-[13rem] bg-white text-slate-800 dark:bg-gray-800 dark:text-slate-100 rounded-xl border border-slate-200 dark:border-gray-700 shadow-lg z-[9999]" x-show="userMenu" x-transition x-cloak>
            <div class="px-4 py-2 text-xs text-slate-500 dark:text-slate-200 border-b border-slate-200 dark:border-gray-700">
              Logged as <span class="font-semibold text-slate-800 dark:text-slate-100" x-text="displayName || '‚Äî'"></span>
            </div>
            <div class="px-4 py-3 border-b border-slate-200 dark:border-gray-700 space-y-2" x-show="tenantId">
              <div class="text-[11px] text-slate-500 dark:text-slate-200" x-text="quotaDisplay">‚Äî</div>
              <div class="h-2 w-full rounded-full bg-slate-200 dark:bg-gray-700 overflow-hidden">
                <div class="h-full bg-emerald-500 transition-all" :style="`width:${quotaPercent}%`"></div>
              </div>
            </div>
            <button class="w-full text-left px-4 py-2 text-sm text-slate-700 dark:text-slate-100 hover:bg-slate-100 dark:hover:bg-slate-700 inline-flex items-center gap-2"
                    @click="toggleTheme()">
              <i :class="theme === 'dark' ? 'fa-regular fa-sun' : 'fa-solid fa-moon'"></i>
              <span x-text="theme === 'dark' ? 'Mode clair' : 'Mode sombre'"></span>
            </button>
            <a class="block px-4 py-2 text-sm text-slate-700 dark:text-slate-100 hover:bg-slate-100 dark:hover:bg-slate-700" href="https://phserres.notion.site/Roadmap-ScenarWall-2bb25b4f22b780639a41dc03438e4f0c?pvs=73" target="_blank" rel="noopener">
              <span class="inline-flex items-center gap-2">
                <i class="fa-solid fa-road"></i>
                <span>Roadmap .ScenarWall.</span>
              </span>
            </a>
            <button class="w-full text-left px-4 py-2 text-sm text-rose-600 dark:text-rose-300 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-b-xl inline-flex items-center gap-2" @click="logout()">
              <i class="fa-solid fa-arrow-right-from-bracket"></i> <span>Logout</span>
            </button>
          </div>
        </div>
        <div :class="sidebarCollapsed ? 'hidden' : 'flex-1'"></div>
        <!-- collapse button-->
        <button
          class="text-slate-600 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800 transition rounded-lg flex items-center"
          :class="sidebarCollapsed
            ? 'w-full px-1 py-3 justify-center flex-1'
            : 'px-3 py-3 justify-center'"
          @click="toggleSidebar()"
          :aria-label="sidebarCollapsed ? 'D√©plier la barre lat√©rale' : 'R√©duire la barre lat√©rale'"
          :title="sidebarCollapsed ? 'D√©plier' : 'R√©duire'">
          <i class="text-base" :class="sidebarCollapsed ? 'fa-solid fa-angles-right' : 'fa-solid fa-angles-left'"></i>
        </button>
      </div>
    </aside>

    <!-- SECONDARY NAV -->
    <aside class="w-56 flex-shrink-0 bg-white dark:bg-gray-950 border-r border-slate-200 dark:border-gray-800 h-screen sticky top-0 overflow-y-auto" data-secondary-nav-container>
      <div class="space-y-3">
          {{SECONDARY_NAV}}
      </div>
    </aside>

    <!-- MAIN -->
    <div class="flex-1 flex flex-col h-screen overflow-hidden min-h-0 bg-slate-50 dark:bg-gray-800">
      <main class="flex-1 p-4 bg-slate-50 dark:bg-gray-800 overflow-y-auto min-h-0 pb-0">
        <div class="flex flex-col min-h-full">
          <div class="flex-1">
            {{CONTENT}}
          </div>

          <footer class="dark:bg-gray-800 backdrop-blur mt-3 px-6 pb-2 flex justify-center">
            <div class="w-full max-w-5xl grid gap-3 md:grid-cols-3 items-center text-slate-600 dark:text-slate-300">
              <div class="inline-flex items-center gap-2 text-xs font-semibold text-slate-700 dark:text-slate-200">
                <i class="fa-brands fa-discord"></i><span>Discord</span> : <span>@Baz1ga & @MattBD</span>
              </div>
              <div class="inline-flex items-center justify-center gap-2 font-semibold text-base text-emerald-500 text-center">
                <span><span class="font-pangolin">.ScenarWall.</span> <span class="text-xs"> 2025 B√™ta</span></span> 
              </div>
              <div class="flex items-center justify-end gap-3 flex-wrap text-xs text-emerald-500">
                <a class="hover:text-emerald-400 transition" href="https://phserres.notion.site/Mentions-l-gales-2b625b4f22b780e4852aeeb762578222?pvs=74" target="_blank" rel="noopener">Mentions l√©gales</a>
                <a class="hover:text-emerald-400 transition" href="https://phserres.notion.site/Politique-de-confidentialit-2b625b4f22b780a6b2dce2997443e591?pvs=73"  target="_blank" rel="noopener">Politique de confidentialit√©</a>
                <a class="hover:text-emerald-400 transition" href="https://phserres.notion.site/Conditions-G-n-rales-d-Utilisation-2b825b4f22b780d68ef6c926efa35af8"  target="_blank" rel="noopener">CGU</a>
              </div>
            </div>
          </footer>
        </div>
      </main>
    </div>
  </div>
</body>
</html>
