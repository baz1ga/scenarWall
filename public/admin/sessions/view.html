<div id="page-content" x-data="sessionViewPage()" x-init="init()" x-cloak>
  <style>
    :root {
      --scenario-accent: #10b981;
    }
  </style>

  <div id="page-secondary-nav" class="space-y-3 text-sm py-4 px-1">
    <div class="flex items-center gap-2">
      <span class="inline-flex h-10 w-10 items-center justify-center rounded-xl bg-emerald-50 text-emerald-600 dark:bg-emerald-900/20 dark:text-emerald-300">
        <i class="text-lg" :class="session?.icon || defaultSessionIcon"></i>
      </span>
      <div class="flex-1 flex items-center text-base font-semibold text-emerald-700 dark:text-emerald-300">
        <span class="truncate" x-text="sessionTitle || t('nav.sessionFallback', 'Session')"></span>
      </div>
    </div>

    <div class="space-y-2">
      <a :href="session?.id ? `/admin/sessions/edit-scenes.html?id=${session.id}` : '/admin/sessions/edit-scenes.html'"
        class="flex items-center justify-between pl-2 py-2 transition hover:border-emerald-400 hover:bg-emerald-50/60 dark:hover:border-emerald-700 dark:hover:bg-emerald-900/20"
        :class="location.pathname.includes('edit-scenes') ? 'bg-emerald-50/60 dark:bg-emerald-900/20' : ''"
        :aria-label="t('accessibility.viewScenes','Voir les scènes')"
        >
          <span
            class="inline-flex items-center gap-2 font-semibold"
            :class="location.pathname.includes('edit-scenes') ? 'text-emerald-700 dark:text-emerald-100' : 'text-slate-700 dark:text-slate-200'"
          >
          <i class="fa-solid fa-clapperboard text-emerald-500"></i> <span x-text="t('nav.scenes', 'Scènes')"></span>
        </span>
      </a>
      <a :href="session?.id ? `/admin/sessions/edit-tension.html?id=${session.id}` : '/admin/sessions/edit-tension.html'"
        class="flex items-center justify-between pl-2 py-2 transition hover:border-emerald-400 hover:bg-emerald-50/60 dark:hover:border-emerald-700 dark:hover:bg-emerald-900/20"
        :class="location.pathname.includes('edit-tension') ? 'bg-emerald-50/60 dark:bg-emerald-900/20' : ''"
        :aria-label="t('accessibility.viewTension','Voir la tension')"
        >
          <span
            class="inline-flex items-center gap-2 font-semibold"
            :class="location.pathname.includes('edit-tension') ? 'text-emerald-700 dark:text-emerald-100' : 'text-slate-700 dark:text-slate-200'"
          >
          <i class="fa-solid fa-bolt text-emerald-500"></i> <span x-text="t('nav.tension', 'Tension')"></span>
        </span>
      </a>
      <a :href="session?.id ? `/admin/sessions/edit-table.html?id=${session.id}` : '/admin/sessions/edit-table.html'"
        class="flex items-center justify-between pl-2 py-2 transition hover:border-emerald-400 hover:bg-emerald-50/60 dark:hover:border-emerald-700 dark:hover:bg-emerald-900/20"
        :class="location.pathname.includes('edit-table') ? 'bg-emerald-50/60 dark:bg-emerald-900/20' : ''"
        :aria-label="t('accessibility.viewPlayers','Voir les joueurs')"
        >
          <span
            class="inline-flex items-center gap-2 font-semibold"
            :class="location.pathname.includes('edit-table') ? 'text-emerald-700 dark:text-emerald-100' : 'text-slate-700 dark:text-slate-200'"
          >
          <i class="fa-solid fa-people-group text-emerald-500"></i> <span x-text="t('nav.players', 'Joueurs')"></span>
        </span>
      </a>
      <a :href="session?.id ? `/admin/sessions/edit-pnj.html?id=${session.id}` : '/admin/sessions/edit-pnj.html'"
        class="flex items-center justify-between pl-2 py-2 transition hover:border-emerald-400 hover:bg-emerald-50/60 dark:hover:border-emerald-700 dark:hover:bg-emerald-900/20"
        :class="location.pathname.includes('edit-pnj') ? 'bg-emerald-50/60 dark:bg-emerald-900/20' : ''"
        :aria-label="t('accessibility.viewPnj','Voir les PNJ')"
        >
          <span
            class="inline-flex items-center gap-2 font-semibold"
            :class="location.pathname.includes('edit-pnj') ? 'text-emerald-700 dark:text-emerald-100' : 'text-slate-700 dark:text-slate-200'"
          >
          <i class="fa-solid fa-user-ninja text-emerald-500"></i> <span x-text="t('nav.pnj', 'PNJ')"></span>
        </span>
      </a>
      <a :href="session?.id ? `/admin/sessions/edit-sessions.html?id=${session.id}` : '/admin/sessions/edit-sessions.html'"
        class="flex items-center justify-between pl-2 py-2 transition hover:border-emerald-400 hover:bg-emerald-50/60 dark:hover:border-emerald-700 dark:hover:bg-emerald-900/20"
        :class="location.pathname.includes('edit-sessions') ? 'bg-emerald-50/60 dark:bg-emerald-900/20' : ''"
        :aria-label="t('accessibility.viewSettings','Voir les paramètres')"
        >
          <span
            class="inline-flex items-center gap-2 font-semibold"
            :class="location.pathname.includes('edit-sessions') ? 'text-emerald-700 dark:text-emerald-100' : 'text-slate-700 dark:text-slate-200'"
          >
          <i class="fa-solid fa-pen-to-square text-emerald-500"></i> <span x-text="t('nav.settings', 'Paramètres')"></span>
        </span>
      </a>      
    </div>

    <div class="pt-2">
      <button x-show="session"
              type="button"
              class="w-full inline-flex items-center justify-center gap-2 h-10 rounded-lg border border-indigo-300 text-indigo-700 dark:text-indigo-200 bg-white dark:bg-gray-900 text-sm font-semibold hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition px-3"
              @click="openGameMaster(session?.id || (new URLSearchParams(window.location.search || '').get('id')))"
              :aria-label="t('accessibility.openGm','Ouvrir le tableau du GM')"
              :title="t('accessibility.openGm','Ouvrir le tableau du GM')">
        <i class="fa-solid fa-hat-wizard"></i> <span x-text="t('nav.gm', 'Game Master')"></span>
      </button>
    </div>
  </div>

<div data-session-content-slot>
  <div class="h-5 w-5 rounded-full border-4 border-emerald-500 border-t-transparent animate-spin"></div>
</div>
<div data-include="character-card"></div>
</div>
<script src="/admin/sessions/session-layout-loader.js"></script>
<!-- Config/auth nécessaires avant l'init Alpine quand on est chargé via session-layout-loader -->
<script src="/js/common/config.js"></script>
<script src="/js/common/auth.js"></script>
<script src="/admin/js/layout-loader.js"></script>
<script type="module" src="/admin/sessions/view.js" data-page-script></script>
